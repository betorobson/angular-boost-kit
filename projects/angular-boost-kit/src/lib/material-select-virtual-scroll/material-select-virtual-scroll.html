<ng-template #defaultTemplate let-itemSelected="itemSelected">
	@if(itemSelected){
    {{itemSelected[config.optionItemDescription]}}
  }
</ng-template>

@if(loading){
  <div class="loading-overlay">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
}

<mat-form-field>
  <mat-label>Items</mat-label>
  <mat-select
    (openedChange)="openedChange()"
    (opened)="opened()"
    [formControl]="config.formControl"
  >
    <mat-select-trigger>
      <ng-container
        [ngTemplateOutlet]="triggerTemplate || optionTemplate || defaultTemplate"
        [ngTemplateOutletContext]="{ itemSelected }"
      ></ng-container>
    </mat-select-trigger>
    @if(!loading){
      <div class="container-panel">
        <mat-form-field
          class="field-search"
        >
          <mat-label>Busca</mat-label>
          <input #inputSearch type="text" matInput [formControl]="formControlSearch" />
        </mat-form-field>
        <cdk-virtual-scroll-viewport
          [itemSize]="48"
          [minBufferPx]="400"
          [maxBufferPx]="400"
          class="virtual-scroll-viewport"
        >
          <mat-option
            *cdkVirtualFor="let optionItem of options"
            [value]="optionItem[config.optionItemId]"
            (click)="itemSelect(optionItem)"
          >
            <ng-container
              [ngTemplateOutlet]="optionTemplate || defaultTemplate"
              [ngTemplateOutletContext]="{ itemSelected: optionItem }"
            ></ng-container>
          </mat-option>
        </cdk-virtual-scroll-viewport>
      </div>
    }
    @if (itemSelected) {
      <mat-option
        [value]="itemSelected[config.optionItemId]"
        class="option-workaround"
      >
      </mat-option>
    }
  </mat-select>
</mat-form-field>
